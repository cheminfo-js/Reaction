/** reaction@0.0.0, MIT licensed. https://github.com/cheminfo/reaction#readme */
(function(e,t){'object'==typeof exports&&'object'==typeof module?module.exports=t():'function'==typeof define&&define.amd?define([],t):'object'==typeof exports?exports.reaction=t():e.reaction=t()})(this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var a=n[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e['default']}:function(){return e};return t.d(n,'a',n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p='',t(t.s=0)}([function(e,t,n){'use strict';function i(e,t,n){var i=t.starting,r=t.reagents,o=t.products,d=t.text,l=n;console.log(e);var u=e.group(),p=s(e,i,{joinBy:'+',font:l}),m=s(e,r,{joinBy:'',isVertical:!0});u.add(p),u.add(m);var x=p.rbox(e),f=Object.assign({},l,{"baseline-shift":'sub',"font-size":'small'}),g=e.text(function(e){for(var t,n=0;n<d.arrow.length;++n){if(t=d.arrow[n],Array.isArray(t))for(var i,a=0;a<t.length;++a)i=e.tspan(t[a]),1==a%2?i.font(f):i.font(l);else if(''!==t&&(e.tspan(t).font(l),'Cat. '===t))continue;e.tspan(' ').font(l).newLine()}}),y=g.rbox(e);g.move(x.x2+y.width/2+c.DISTANCE,x.cy+c.DISTANCE);var v=m.rbox(e);m.dmove(x.width/2+v.width/2+c.DISTANCE,x.cy-v.cy-v.height/2-c.DISTANCE);var b=h;if(v=m.rbox(e),y=g.rbox(e),y.width>v.width){b+=y.width;var w=b/2-v.width/2,C=c.DISTANCE/2}else b+=v.width,w=c.DISTANCE/2,C=b/2-y.width/2;m.x(m.x()+w),g.x(g.x()+C);var N=a(e,x.x2+c.DISTANCE,x.cy,b),P=m.rbox(e).w;m.transform({scale:0.8});var k=m.rbox(e).w;m.dmove(0,P-k-c.DISTANCE),u.add(N),u.add(g);var A=u.rbox(e),S=s(e,o,{labels:d.products,isVertical:!1,joinBy:'+',font:l}),E=S.rbox(e);S.dmove(Math.abs(A.x2-E.x)+c.DISTANCE,0),u.add(S),A=u.rbox(e),e.size(A.x+A.width,A.y+A.height)}function a(e,t,n,i){var a=e.group();a.line(t,n,t+i,n).stroke({width:1});var r=a.polygon([0,0,7,7,0,7]);return r.center(t+i,n).rotate(-135),a}function r(e,t){var n=e.group();n.svg(t);var i=n.rbox(e);return n.move(-i.x,-i.y),n}function o(e,t,n){e.center(e.x()+t,e.y()+n)}function s(e,t,n){for(var a=n.joinBy,s=n.isVertical,d=n.labels,l=n.font,u=e.group(),p=100,h=100,x=0;x<t.length;++x){var i=t[x],f=i.toSVG(200,200,x+'',m),g=r(e,f);if(a&&0<x){var y=u.text(a);y.center(p,h);var v=g.rbox(e),b=c.DISTANCE+v.width/2;s?h+=b:p+=b}o(g,p,h);var w=g.rbox(e);d&&d[x]&&(y=u.text(d[x]),y.font(l),y.move(w.cx,w.cy+20)),b=c.DISTANCE+w.width/2,s?h+=b:p+=b,u.add(g)}return u.move(100,100),u}Object.defineProperty(t,'__esModule',{value:!0});var d=n(1),l=n(3),u=function(e){return e&&e.__esModule?e:{default:e}}(l),c={DISTANCE:10,SVG_OPTIONS:{suppressChiralText:!0,suppressCIPParity:!0,suppressESR:!0,noStereoProblem:!0}};class p{constructor(e,t){this.data=e,this.OCL=void 0;var n=t.catPrefix,i=t.font,a=i===void 0?{family:'Helvetica',anchor:'middle',size:15}:i,r=t.domElement;this.catPrefix=n!==void 0&&n,this.font=a,this.domElement=r}setOCL(e){this.OCL=e}static fromJSON(e,t){return new p(e,t)}static fromRXN(e,t){return p.fromJSON((0,d.getFormat)(e),t)}toSVG(){if(void 0===this.OCL)throw new Error('OCL is not defined on this instance of reaction');var e=(0,d.organizeData)(this.data,this.catPrefix,this.OCL),t=(0,u.default)(this.domElement);return i(t,e,this.font),t.svg()}}t.default=p;var h=10,m={suppressChiralText:!0,suppressCIPParity:!0,suppressESR:!0,noStereoProblem:!0}},function(e,t,n){'use strict';function a(e){return(t)=>e.Molecule.fromIDCode(t.ocl.idCode)}function r(e,t,n){var a={products:[]},r=[],s=e.reagents.find((e)=>'catalyst'===e.kind);s&&(t&&r.push('Cat. '),r.push(o(n(s).getMolecularFormula().formula)));var d=e.reagents.find((e)=>'solvent'===e.kind);d&&r.push(o(n(d).getMolecularFormula().formula)),r.push(e.conditions.replace(/(<([^>]+)>)|\n/ig,''));var l=e.products,u='';if(1===l.length)u=`Best yield: ${l[0].yield+''} %`;else if(1<l.length){for(var c,p=-1,h=0;h<l.length;++h)c=l[h],a.products.push(`${c.yield+''} %`),c.yield>p&&(p=c.yield);u=`Best yield: ${p+''} %`}return r.push(u),a.arrow=r,a}function o(e){for(var t=[/[A-Za-z]/,/\d/],n=0,a=t[n],r=[],o='',s=0;s<e.length;++s)a.test(e[s])?o+=e[s]:(r.push(o),o=e[s],n=(n+1)%2,a=t[n]);return r.push(o),r}Object.defineProperty(t,'__esModule',{value:!0}),t.getFormat=function(e,t){var n=(0,s.default)(e),i=n.reagents,a=n.products;return i=i.map((e)=>{var n={},i=t.Molecule.fromMolfile(e);return n.ocl=i.getIDCodeAndCoordinates(),n.kind='starting material',n}),a=a.map((e)=>{var n={},i=t.Molecule.fromMolfile(e);return n.ocl=i.getIDCodeAndCoordinates(),n}),{reagents:i,products:a,conditions:''}},t.organizeData=function(e,t,n){for(var o,s=a(n),d={products:e.products.map(s),text:r(e,t,s)},l=[],u=[],c=0;c<e.reagents.length;++c)switch(o=e.reagents[c],o.kind){case'reagent':u.push(s(o));break;case'starting material':l.push(s(o));break;default:}return d.starting=l,d.reagents=u,d};var i=n(2),s=function(e){return e&&e.__esModule?e:{default:e}}(i)},function(e){'use strict';e.exports=function(e){if('string'!=typeof e)throw new TypeError('Parameter "rxn" must be a string');var t=e.substr(0,1e3),n='\n';-1<t.indexOf('\r\n')?n='\r\n':-1<t.indexOf('\r')&&(n='\r');var a=e.split(n+'$MOL'+n),r=[],o=[],s={};if(s.reagents=r,s.products=o,0===a.length)throw new Error('file looks empty');var t=a[0];if(0!=t.indexOf('$RXN'))throw new Error('file does not start with $RXN');var d=t.split(n);if(5>d.length)throw new Error('incorrect number of lines in header');var l=d[4].substring(0,3)>>0,u=d[4].substring(3,6)>>0;if(l+u!=a.length-1)throw new Error('not the correct number of molecules');for(var c=1;c<a.length;c++)c<=l?r.push(a[c]):o.push(a[c]);return s}},function(e,t,n){'use strict';function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0});var a=n(4);Object.defineProperty(t,'default',{enumerable:!0,get:function(){return i(a).default}}),console.log('im in a browser!')},function(e,t,n){'use strict';var i;/*!
* svg.js - A lightweight library for manipulating and animating SVG.
* @version 2.6.3
* https://svgdotjs.github.io/
*
* @copyright Wout Fierens <wout@mick-wout.com>
* @license MIT
*
* BUILT: Fri Jul 21 2017 14:50:37 GMT+0200 (Mitteleurop√§ische Sommerzeit)
*/(function(a,r){i=function(){return r(a,a.document)}.call(t,n,t,e),!(i!==void 0&&(e.exports=i))})('undefined'==typeof window?void 0:window,function(e,t){function n(e,t,n,i){return n+i.replace(k.regex.dots,' .')}function a(e){for(var t=e.slice(0),n=t.length;n--;)Array.isArray(t[n])&&(t[n]=a(t[n]));return t}function r(e,t){return e instanceof t}function o(e,t){return(e.matches||e.matchesSelector||e.msMatchesSelector||e.mozMatchesSelector||e.webkitMatchesSelector||e.oMatchesSelector).call(e,t)}function d(e){return e.toLowerCase().replace(/-(.)/g,function(e,t){return t.toUpperCase()})}function s(e){return e.charAt(0).toUpperCase()+e.slice(1)}function l(e){return 4==e.length?['#',e.substring(1,2),e.substring(1,2),e.substring(2,3),e.substring(2,3),e.substring(3,4),e.substring(3,4)].join(''):e}function u(e){var t=e.toString(16);return 1==t.length?'0'+t:t}function c(e,t,n){if(null==t||null==n){var i=e.bbox();null==t?t=i.width/i.height*n:null==n&&(n=i.height/i.width*t)}return{width:t,height:n}}function p(e,t,n){return{x:t*e.a+n*e.c+0,y:t*e.b+n*e.d+0}}function h(e){return{a:e[0],b:e[1],c:e[2],d:e[3],e:e[4],f:e[5]}}function m(e){return e instanceof k.Matrix||(e=new k.Matrix(e)),e}function x(e,t){e.cx=null==e.cx?t.bbox().cx:e.cx,e.cy=null==e.cy?t.bbox().cy:e.cy}function f(e){for(var t=0,n=e.length,i='';t<n;t++)i+=e[t][0],null!=e[t][1]&&(i+=e[t][1],null!=e[t][2]&&(i+=' ',i+=e[t][2],null!=e[t][3]&&(i+=' ',i+=e[t][3],i+=' ',i+=e[t][4],null!=e[t][5]&&(i+=' ',i+=e[t][5],i+=' ',i+=e[t][6],null!=e[t][7]&&(i+=' ',i+=e[t][7])))));return i+' '}function g(t){for(var n=t.childNodes.length-1;0<=n;n--)t.childNodes[n]instanceof e.SVGElement&&g(t.childNodes[n]);return k.adopt(t).id(k.eid(t.nodeName))}function v(e){return null==e.x&&(e.x=0,e.y=0,e.width=0,e.height=0),e.w=e.width,e.h=e.height,e.x2=e.x+e.width,e.y2=e.y+e.height,e.cx=e.x+e.width/2,e.cy=e.y+e.height/2,e}function y(e){var t=e.toString().match(k.regex.reference);if(t)return t[1]}var w=Math.min,C=Math.max,b=Math.sin,N=Math.cos,P=Math.PI,k=this.SVG=function(e){if(k.supported)return e=new k.Doc(e),k.parser.draw||k.prepare(),e};if(k.ns='http://www.w3.org/2000/svg',k.xmlns='http://www.w3.org/2000/xmlns/',k.xlink='http://www.w3.org/1999/xlink',k.svgjs='http://svgjs.com/svgjs',k.supported=function(){return!!t.createElementNS&&!!t.createElementNS(k.ns,'svg').createSVGRect}(),!k.supported)return!1;k.did=1e3,k.eid=function(e){return'Svgjs'+s(e)+k.did++},k.create=function(e){var n=t.createElementNS(this.ns,e);return n.setAttribute('id',this.eid(e)),n},k.extend=function(){var e,t,n,a;for(e=[].slice.call(arguments),t=e.pop(),a=e.length-1;0<=a;a--)if(e[a])for(n in t)e[a].prototype[n]=t[n];k.Set&&k.Set.inherit&&k.Set.inherit()},k.invent=function(e){var t='function'==typeof e.create?e.create:function(){this.constructor.call(this,k.create(e.create))};return e.inherit&&(t.prototype=new e.inherit),e.extend&&k.extend(t,e.extend),e.construct&&k.extend(e.parent||k.Container,e.construct),t},k.adopt=function(t){if(!t)return null;if(t.instance)return t.instance;var n;return n='svg'==t.nodeName?t.parentNode instanceof e.SVGElement?new k.Nested:new k.Doc:'linearGradient'==t.nodeName?new k.Gradient('linear'):'radialGradient'==t.nodeName?new k.Gradient('radial'):k[s(t.nodeName)]?new k[s(t.nodeName)]:new k.Element(t),n.type=t.nodeName,n.node=t,t.instance=n,n instanceof k.Doc&&n.namespace().defs(),n.setData(JSON.parse(t.getAttribute('svgjs:data'))||{}),n},k.prepare=function(){var e=t.getElementsByTagName('body')[0],n=(e?new k.Doc(e):k.adopt(t.documentElement).nested()).size(2,0);k.parser={body:e||t.documentElement,draw:n.style('opacity:0;position:absolute;left:-100%;top:-100%;overflow:hidden').node,poly:n.polyline().node,path:n.path().node,native:k.create('svg')}},k.parser={native:k.create('svg')},t.addEventListener('DOMContentLoaded',function(){k.parser.draw||k.prepare()},!1),k.regex={numberAndUnit:/^([+-]?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?)([a-z%]*)$/i,hex:/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,rgb:/rgb\((\d+),(\d+),(\d+)\)/,reference:/#([a-z0-9\-_]+)/i,transforms:/\)\s*,?\s*/,whitespace:/\s/g,isHex:/^#[a-f0-9]{3,6}$/i,isRgb:/^rgb\(/,isCss:/[^:]+:[^;]+;?/,isBlank:/^(\s+)?$/,isNumber:/^[+-]?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,isPercent:/^-?[\d\.]+%$/,isImage:/\.(jpg|jpeg|png|gif|svg)(\?[^=]+.*)?/i,delimiter:/[\s,]+/,hyphen:/([^e])\-/gi,pathLetters:/[MLHVCSQTAZ]/gi,isPathLetter:/[MLHVCSQTAZ]/i,numbersWithDots:/((\d?\.\d+(?:e[+-]?\d+)?)((?:\.\d+(?:e[+-]?\d+)?)+))+/gi,dots:/\./g},k.utils={map:function(e,t){var n,i=e.length,a=[];for(n=0;n<i;n++)a.push(t(e[n]));return a},filter:function(e,t){var n,i=e.length,a=[];for(n=0;n<i;n++)t(e[n])&&a.push(e[n]);return a},radians:function(e){return e%360*P/180},degrees:function(e){return 180*e/P%360},filterSVGElements:function(t){return this.filter(t,function(t){return t instanceof e.SVGElement})}},k.defaults={attrs:{"fill-opacity":1,"stroke-opacity":1,"stroke-width":0,"stroke-linejoin":'miter',"stroke-linecap":'butt',fill:'#000000',stroke:'#000000',opacity:1,x:0,y:0,cx:0,cy:0,width:0,height:0,r:0,rx:0,ry:0,offset:0,"stop-opacity":1,"stop-color":'#000000',"font-size":16,"font-family":'Helvetica, Arial, sans-serif',"text-anchor":'start'}},k.Color=function(e){var t;this.r=0,this.g=0,this.b=0,e&&('string'==typeof e?k.regex.isRgb.test(e)?(t=k.regex.rgb.exec(e.replace(k.regex.whitespace,'')),this.r=parseInt(t[1]),this.g=parseInt(t[2]),this.b=parseInt(t[3])):k.regex.isHex.test(e)&&(t=k.regex.hex.exec(l(e)),this.r=parseInt(t[1],16),this.g=parseInt(t[2],16),this.b=parseInt(t[3],16)):'object'==typeof e&&(this.r=e.r,this.g=e.g,this.b=e.b))},k.extend(k.Color,{toString:function(){return this.toHex()},toHex:function(){return'#'+u(this.r)+u(this.g)+u(this.b)},toRgb:function(){return'rgb('+[this.r,this.g,this.b].join()+')'},brightness:function(){return 0.3*(this.r/255)+0.59*(this.g/255)+0.11*(this.b/255)},morph:function(e){return this.destination=new k.Color(e),this},at:function(e){return this.destination?(e=0>e?0:1<e?1:e,new k.Color({r:~~(this.r+(this.destination.r-this.r)*e),g:~~(this.g+(this.destination.g-this.g)*e),b:~~(this.b+(this.destination.b-this.b)*e)})):this}}),k.Color.test=function(e){return e+='',k.regex.isHex.test(e)||k.regex.isRgb.test(e)},k.Color.isRgb=function(e){return e&&'number'==typeof e.r&&'number'==typeof e.g&&'number'==typeof e.b},k.Color.isColor=function(e){return k.Color.isRgb(e)||k.Color.test(e)},k.Array=function(e,t){e=(e||[]).valueOf(),0==e.length&&t&&(e=t.valueOf()),this.value=this.parse(e)},k.extend(k.Array,{morph:function(e){if(this.destination=this.parse(e),this.value.length!=this.destination.length){for(var t=this.value[this.value.length-1],n=this.destination[this.destination.length-1];this.value.length>this.destination.length;)this.destination.push(n);for(;this.value.length<this.destination.length;)this.value.push(t)}return this},settle:function(){for(var e=0,t=this.value.length,n=[];e<t;e++)-1==n.indexOf(this.value[e])&&n.push(this.value[e]);return this.value=n},at:function(e){if(!this.destination)return this;for(var t=0,n=this.value.length,i=[];t<n;t++)i.push(this.value[t]+(this.destination[t]-this.value[t])*e);return new k.Array(i)},toString:function(){return this.value.join(' ')},valueOf:function(){return this.value},parse:function(e){return e=e.valueOf(),Array.isArray(e)?e:this.split(e)},split:function(e){return e.trim().split(k.regex.delimiter).map(parseFloat)},reverse:function(){return this.value.reverse(),this},clone:function(){var e=new this.constructor;return e.value=a(this.value),e}}),k.PointArray=function(e,t){k.Array.call(this,e,t||[[0,0]])},k.PointArray.prototype=new k.Array,k.PointArray.prototype.constructor=k.PointArray,k.extend(k.PointArray,{toString:function(){for(var e=0,t=this.value.length,n=[];e<t;e++)n.push(this.value[e].join(','));return n.join(' ')},toLine:function(){return{x1:this.value[0][0],y1:this.value[0][1],x2:this.value[1][0],y2:this.value[1][1]}},at:function(e){if(!this.destination)return this;for(var t=0,n=this.value.length,i=[];t<n;t++)i.push([this.value[t][0]+(this.destination[t][0]-this.value[t][0])*e,this.value[t][1]+(this.destination[t][1]-this.value[t][1])*e]);return new k.PointArray(i)},parse:function(e){var t=[];if(e=e.valueOf(),!Array.isArray(e))e=e.trim().split(k.regex.delimiter).map(parseFloat);else if(Array.isArray(e[0]))return e;0!=e.length%2&&e.pop();for(var n=0,i=e.length;n<i;n+=2)t.push([e[n],e[n+1]]);return t},move:function(e,t){var n=this.bbox();if(e-=n.x,t-=n.y,!isNaN(e)&&!isNaN(t))for(var a=this.value.length-1;0<=a;a--)this.value[a]=[this.value[a][0]+e,this.value[a][1]+t];return this},size:function(e,t){var n,i=this.bbox();for(n=this.value.length-1;0<=n;n--)i.width&&(this.value[n][0]=(this.value[n][0]-i.x)*e/i.width+i.x),i.height&&(this.value[n][1]=(this.value[n][1]-i.y)*t/i.height+i.y);return this},bbox:function(){return k.parser.poly.setAttribute('points',this.toString()),k.parser.poly.getBBox()}});for(var A={M:function(e,t,n){return t.x=n.x=e[0],t.y=n.y=e[1],['M',t.x,t.y]},L:function(e,t){return t.x=e[0],t.y=e[1],['L',e[0],e[1]]},H:function(e,t){return t.x=e[0],['H',e[0]]},V:function(e,t){return t.y=e[0],['V',e[0]]},C:function(e,t){return t.x=e[4],t.y=e[5],['C',e[0],e[1],e[2],e[3],e[4],e[5]]},S:function(e,t){return t.x=e[2],t.y=e[3],['S',e[0],e[1],e[2],e[3]]},Q:function(e,t){return t.x=e[2],t.y=e[3],['Q',e[0],e[1],e[2],e[3]]},T:function(e,t){return t.x=e[0],t.y=e[1],['T',e[0],e[1]]},Z:function(e,t,n){return t.x=n.x,t.y=n.y,['Z']},A:function(e,t){return t.x=e[5],t.y=e[6],['A',e[0],e[1],e[2],e[3],e[4],e[5],e[6]]}},S=['m','l','h','v','q','t','c','s','a','z'],E=0,i=S.length;E<i;++E)A[S[E]]=function(e){return function(t,n,i){if('H'==e)t[0]+=n.x;else if('V'==e)t[0]+=n.y;else if('A'==e)t[5]+=n.x,t[6]+=n.y;else for(var a=0,r=t.length;a<r;++a)t[a]+=a%2?n.y:n.x;return A[e](t,n,i)}}(S[E].toUpperCase());k.PathArray=function(e,t){k.Array.call(this,e,t||[['M',0,0]])},k.PathArray.prototype=new k.Array,k.PathArray.prototype.constructor=k.PathArray,k.extend(k.PathArray,{toString:function(){return f(this.value)},move:function(e,t){var n=this.bbox();if(e-=n.x,t-=n.y,!isNaN(e)&&!isNaN(t))for(var a,r=this.value.length-1;0<=r;r--)a=this.value[r][0],'M'==a||'L'==a||'T'==a?(this.value[r][1]+=e,this.value[r][2]+=t):'H'==a?this.value[r][1]+=e:'V'==a?this.value[r][1]+=t:'C'==a||'S'==a||'Q'==a?(this.value[r][1]+=e,this.value[r][2]+=t,this.value[r][3]+=e,this.value[r][4]+=t,'C'==a&&(this.value[r][5]+=e,this.value[r][6]+=t)):'A'==a&&(this.value[r][6]+=e,this.value[r][7]+=t);return this},size:function(e,t){var n,i,a=this.bbox();for(n=this.value.length-1;0<=n;n--)i=this.value[n][0],'M'==i||'L'==i||'T'==i?(this.value[n][1]=(this.value[n][1]-a.x)*e/a.width+a.x,this.value[n][2]=(this.value[n][2]-a.y)*t/a.height+a.y):'H'==i?this.value[n][1]=(this.value[n][1]-a.x)*e/a.width+a.x:'V'==i?this.value[n][1]=(this.value[n][1]-a.y)*t/a.height+a.y:'C'==i||'S'==i||'Q'==i?(this.value[n][1]=(this.value[n][1]-a.x)*e/a.width+a.x,this.value[n][2]=(this.value[n][2]-a.y)*t/a.height+a.y,this.value[n][3]=(this.value[n][3]-a.x)*e/a.width+a.x,this.value[n][4]=(this.value[n][4]-a.y)*t/a.height+a.y,'C'==i&&(this.value[n][5]=(this.value[n][5]-a.x)*e/a.width+a.x,this.value[n][6]=(this.value[n][6]-a.y)*t/a.height+a.y)):'A'==i&&(this.value[n][1]=this.value[n][1]*e/a.width,this.value[n][2]=this.value[n][2]*t/a.height,this.value[n][6]=(this.value[n][6]-a.x)*e/a.width+a.x,this.value[n][7]=(this.value[n][7]-a.y)*t/a.height+a.y);return this},equalCommands:function(e){var t,n,i;for(e=new k.PathArray(e),i=this.value.length===e.value.length,(t=0,n=this.value.length);i&&t<n;t++)i=this.value[t][0]===e.value[t][0];return i},morph:function(e){return e=new k.PathArray(e),this.destination=this.equalCommands(e)?e:null,this},at:function(e){if(!this.destination)return this;var t,n,i,a,r=this.value,o=this.destination.value,s=[],d=new k.PathArray;for(t=0,n=r.length;t<n;t++){for(s[t]=[r[t][0]],i=1,a=r[t].length;i<a;i++)s[t][i]=r[t][i]+(o[t][i]-r[t][i])*e;'A'===s[t][0]&&(s[t][4]=+(0!=s[t][4]),s[t][5]=+(0!=s[t][5]))}return d.value=s,d},parse:function(e){if(e instanceof k.PathArray)return e.valueOf();var t,i;e='string'==typeof e?e.replace(k.regex.numbersWithDots,n).replace(k.regex.pathLetters,' $& ').replace(k.regex.hyphen,'$1 -').trim().split(k.regex.delimiter):e.reduce(function(e,t){return[].concat.call(e,t)},[]);var i=[],a=new k.Point,r=new k.Point,o=0,s=e.length;do k.regex.isPathLetter.test(e[o])?(t=e[o],++o):'M'==t?t='L':'m'==t&&(t='l'),i.push(A[t].call(null,e.slice(o,o+={M:2,L:2,H:1,V:1,C:6,S:4,Q:4,T:2,A:7,Z:0}[t.toUpperCase()]).map(parseFloat),a,r));while(s>o);return i},bbox:function(){return k.parser.path.setAttribute('d',this.toString()),k.parser.path.getBBox()}}),k.Number=k.invent({create:function(e,t){this.value=0,this.unit=t||'','number'==typeof e?this.value=isNaN(e)?0:isFinite(e)?e:0>e?-3.4e38:3.4e+38:'string'==typeof e?(t=e.match(k.regex.numberAndUnit),t&&(this.value=parseFloat(t[1]),'%'==t[5]?this.value/=100:'s'==t[5]&&(this.value*=1e3),this.unit=t[5])):e instanceof k.Number&&(this.value=e.valueOf(),this.unit=e.unit)},extend:{toString:function(){return('%'==this.unit?~~(1e8*this.value)/1e6:'s'==this.unit?this.value/1e3:this.value)+this.unit},toJSON:function(){return this.toString()},valueOf:function(){return this.value},plus:function(e){return e=new k.Number(e),new k.Number(this+e,this.unit||e.unit)},minus:function(e){return e=new k.Number(e),new k.Number(this-e,this.unit||e.unit)},times:function(e){return e=new k.Number(e),new k.Number(this*e,this.unit||e.unit)},divide:function(e){return e=new k.Number(e),new k.Number(this/e,this.unit||e.unit)},to:function(e){var t=new k.Number(this);return'string'==typeof e&&(t.unit=e),t},morph:function(e){return this.destination=new k.Number(e),e.relative&&(this.destination.value+=this.value),this},at:function(e){return this.destination?new k.Number(this.destination).minus(this).times(e).plus(this):this}}}),k.Element=k.invent({create:function(e){this._stroke=k.defaults.attrs.stroke,this._event=null,this.dom={},(this.node=e)&&(this.type=e.nodeName,this.node.instance=this,this._stroke=e.getAttribute('stroke')||this._stroke)},extend:{x:function(e){return this.attr('x',e)},y:function(e){return this.attr('y',e)},cx:function(e){return null==e?this.x()+this.width()/2:this.x(e-this.width()/2)},cy:function(e){return null==e?this.y()+this.height()/2:this.y(e-this.height()/2)},move:function(e,t){return this.x(e).y(t)},center:function(e,t){return this.cx(e).cy(t)},width:function(e){return this.attr('width',e)},height:function(e){return this.attr('height',e)},size:function(e,t){var n=c(this,e,t);return this.width(new k.Number(n.width)).height(new k.Number(n.height))},clone:function(e){this.writeDataToDom();var t=g(this.node.cloneNode(!0));return e?e.add(t):this.after(t),t},remove:function(){return this.parent()&&this.parent().removeElement(this),this},replace:function(e){return this.after(e).remove(),e},addTo:function(e){return e.put(this)},putIn:function(e){return e.add(this)},id:function(e){return this.attr('id',e)},inside:function(e,t){var n=this.bbox();return e>n.x&&t>n.y&&e<n.x+n.width&&t<n.y+n.height},show:function(){return this.style('display','')},hide:function(){return this.style('display','none')},visible:function(){return'none'!=this.style('display')},toString:function(){return this.attr('id')},classes:function(){var e=this.attr('class');return null==e?[]:e.trim().split(k.regex.delimiter)},hasClass:function(e){return-1!=this.classes().indexOf(e)},addClass:function(e){if(!this.hasClass(e)){var t=this.classes();t.push(e),this.attr('class',t.join(' '))}return this},removeClass:function(e){return this.hasClass(e)&&this.attr('class',this.classes().filter(function(t){return t!=e}).join(' ')),this},toggleClass:function(e){return this.hasClass(e)?this.removeClass(e):this.addClass(e)},reference:function(e){return k.get(this.attr(e))},parent:function(t){var n=this;if(!n.node.parentNode)return null;if(n=k.adopt(n.node.parentNode),!t)return n;for(;n&&n.node instanceof e.SVGElement;){if('string'==typeof t?n.matches(t):n instanceof t)return n;if('#document'==n.node.parentNode.nodeName)return null;n=k.adopt(n.node.parentNode)}},doc:function(){return this instanceof k.Doc?this:this.parent(k.Doc)},parents:function(e){var t=[],n=this;do{if(n=n.parent(e),!n||!n.node)break;t.push(n)}while(n.parent);return t},matches:function(e){return o(this.node,e)},native:function(){return this.node},svg:function(e){var n=t.createElement('svg');if(e&&this instanceof k.Parent){n.innerHTML='<svg>'+e.replace(/\n/,'').replace(/<(\w+)([^<]+?)\/>/g,'<$1$2></$1>')+'</svg>';for(var a=0,i=n.firstChild.childNodes.length;a<i;a++)this.node.appendChild(n.firstChild.firstChild)}else return n.appendChild(e=t.createElement('svg')),this.writeDataToDom(),e.appendChild(this.node.cloneNode(!0)),n.innerHTML.replace(/^<svg>/,'').replace(/<\/svg>$/,'');return this},writeDataToDom:function(){if(this.each||this.lines){var e=this.each?this:this.lines();e.each(function(){this.writeDataToDom()})}return this.node.removeAttribute('svgjs:data'),Object.keys(this.dom).length&&this.node.setAttribute('svgjs:data',JSON.stringify(this.dom)),this},setData:function(e){return this.dom=e,this},is:function(e){return r(this,e)}}}),k.easing={"-":function(e){return e},"<>":function(e){return-N(e*P)/2+0.5},">":function(e){return b(e*P/2)},"<":function(e){return-N(e*P/2)+1}},k.morph=function(e){return function(t,n){return new k.MorphObj(t,n).at(e)}},k.Situation=k.invent({create:function(e){this.init=!1,this.reversed=!1,this.reversing=!1,this.duration=new k.Number(e.duration).valueOf(),this.delay=new k.Number(e.delay).valueOf(),this.start=+new Date+this.delay,this.finish=this.start+this.duration,this.ease=e.ease,this.loop=0,this.loops=!1,this.animations={},this.attrs={},this.styles={},this.transforms=[],this.once={}}}),k.FX=k.invent({create:function(e){this._target=e,this.situations=[],this.active=!1,this.situation=null,this.paused=!1,this.lastPos=0,this.pos=0,this.absPos=0,this._speed=1},extend:{animate:function(e,t,n){'object'==typeof e&&(t=e.ease,n=e.delay,e=e.duration);var i=new k.Situation({duration:e||1e3,delay:n||0,ease:k.easing[t||'-']||t});return this.queue(i),this},delay:function(e){var t=new k.Situation({duration:e,delay:0,ease:k.easing['-']});return this.queue(t)},target:function(e){return e&&e instanceof k.Element?(this._target=e,this):this._target},timeToAbsPos:function(e){return(e-this.situation.start)/(this.situation.duration/this._speed)},absPosToTime:function(e){return this.situation.duration/this._speed*e+this.situation.start},startAnimFrame:function(){this.stopAnimFrame(),this.animationFrame=e.requestAnimationFrame(function(){this.step()}.bind(this))},stopAnimFrame:function(){e.cancelAnimationFrame(this.animationFrame)},start:function(){return!this.active&&this.situation&&(this.active=!0,this.startCurrent()),this},startCurrent:function(){return this.situation.start=+new Date+this.situation.delay/this._speed,this.situation.finish=this.situation.start+this.situation.duration/this._speed,this.initAnimations().step()},queue:function(e){return('function'==typeof e||e instanceof k.Situation)&&this.situations.push(e),this.situation||(this.situation=this.situations.shift()),this},dequeue:function(){return this.stop(),this.situation=this.situations.shift(),this.situation&&(this.situation instanceof k.Situation?this.start():this.situation.call(this)),this},initAnimations:function(){var e,t,n,i=this.situation;if(i.init)return this;for(e in i.animations)for(n=this.target()[e](),Array.isArray(n)||(n=[n]),Array.isArray(i.animations[e])||(i.animations[e]=[i.animations[e]]),t=n.length;t--;)i.animations[e][t]instanceof k.Number&&(n[t]=new k.Number(n[t])),i.animations[e][t]=n[t].morph(i.animations[e][t]);for(e in i.attrs)i.attrs[e]=new k.MorphObj(this.target().attr(e),i.attrs[e]);for(e in i.styles)i.styles[e]=new k.MorphObj(this.target().style(e),i.styles[e]);return i.initialTransformation=this.target().matrixify(),i.init=!0,this},clearQueue:function(){return this.situations=[],this},clearCurrent:function(){return this.situation=null,this},stop:function(e,t){var n=this.active;return this.active=!1,t&&this.clearQueue(),e&&this.situation&&(!n&&this.startCurrent(),this.atEnd()),this.stopAnimFrame(),this.clearCurrent()},reset:function(){if(this.situation){var e=this.situation;this.stop(),this.situation=e,this.atStart()}return this},finish:function(){for(this.stop(!0,!1);this.dequeue().situation&&this.stop(!0,!1););return this.clearQueue().clearCurrent(),this},atStart:function(){return this.at(0,!0)},atEnd:function(){return!0===this.situation.loops&&(this.situation.loops=this.situation.loop+1),'number'==typeof this.situation.loops?this.at(this.situation.loops,!0):this.at(1,!0)},at:function(e,t){var n=this.situation.duration/this._speed;return this.absPos=e,t||(this.situation.reversed&&(this.absPos=1-this.absPos),this.absPos+=this.situation.loop),this.situation.start=+new Date-this.absPos*n,this.situation.finish=this.situation.start+n,this.step(!0)},speed:function(e){return 0===e?this.pause():e?(this._speed=e,this.at(this.absPos,!0)):this._speed},loop:function(e,t){var n=this.last();return n.loops=null==e||e,n.loop=0,t&&(n.reversing=!0),this},pause:function(){return this.paused=!0,this.stopAnimFrame(),this},play:function(){return this.paused?(this.paused=!1,this.at(this.absPos,!0)):this},reverse:function(e){var t=this.last();return t.reversed='undefined'==typeof e?!t.reversed:e,this},progress:function(e){return e?this.situation.ease(this.pos):this.pos},after:function(t){var n=this.last();return this.target().on('finished.fx',function i(a){a.detail.situation==n&&(t.call(this,n),this.off('finished.fx',i))}),this._callStart()},during:function(t){var n=this.last(),e=function(i){i.detail.situation==n&&t.call(this,i.detail.pos,k.morph(i.detail.pos),i.detail.eased,n)};return this.target().off('during.fx',e).on('during.fx',e),this.after(function(){this.off('during.fx',e)}),this._callStart()},afterAll:function(e){var t=function t(){e.call(this),this.off('allfinished.fx',t)};return this.target().off('allfinished.fx',t).on('allfinished.fx',t),this._callStart()},duringAll:function(t){var e=function(n){t.call(this,n.detail.pos,k.morph(n.detail.pos),n.detail.eased,n.detail.situation)};return this.target().off('during.fx',e).on('during.fx',e),this.afterAll(function(){this.off('during.fx',e)}),this._callStart()},last:function(){return this.situations.length?this.situations[this.situations.length-1]:this.situation},add:function(e,t,n){return this.last()[n||'animations'][e]=t,this._callStart()},step:function(e){if(e||(this.absPos=this.timeToAbsPos(+new Date)),!1!==this.situation.loops){var t,n,a;t=C(this.absPos,0),n=Math.floor(t),!0===this.situation.loops||n<this.situation.loops?(this.pos=t-n,a=this.situation.loop,this.situation.loop=n):(this.absPos=this.situation.loops,this.pos=1,a=this.situation.loop-1,this.situation.loop=this.situation.loops),this.situation.reversing&&(this.situation.reversed=this.situation.reversed!=!!((this.situation.loop-a)%2))}else this.absPos=w(this.absPos,1),this.pos=this.absPos;0>this.pos&&(this.pos=0),this.situation.reversed&&(this.pos=1-this.pos);var r=this.situation.ease(this.pos);for(var o in this.situation.once)o>this.lastPos&&o<=r&&(this.situation.once[o].call(this.target(),this.pos,r),delete this.situation.once[o]);return(this.active&&this.target().fire('during',{pos:this.pos,eased:r,fx:this,situation:this.situation}),!this.situation)?this:(this.eachAt(),1==this.pos&&!this.situation.reversed||this.situation.reversed&&0==this.pos?(this.stopAnimFrame(),this.target().fire('finished',{fx:this,situation:this.situation}),!this.situations.length&&(this.target().fire('allfinished'),!this.situations.length&&(this.target().off('.fx'),this.active=!1)),this.active?this.dequeue():this.clearCurrent()):!this.paused&&this.active&&this.startAnimFrame(),this.lastPos=r,this)},eachAt:function(){var e,t,n,i=this,r=this.target(),o=this.situation;for(e in o.animations)n=[].concat(o.animations[e]).map(function(e){return'string'!=typeof e&&e.at?e.at(o.ease(i.pos),i.pos):e}),r[e].apply(r,n);for(e in o.attrs)n=[e].concat(o.attrs[e]).map(function(e){return'string'!=typeof e&&e.at?e.at(o.ease(i.pos),i.pos):e}),r.attr.apply(r,n);for(e in o.styles)n=[e].concat(o.styles[e]).map(function(e){return'string'!=typeof e&&e.at?e.at(o.ease(i.pos),i.pos):e}),r.style.apply(r,n);if(o.transforms.length){for(n=o.initialTransformation,e=0,t=o.transforms.length;e<t;e++){var s=o.transforms[e];if(s instanceof k.Matrix){n=s.relative?n.multiply(new k.Matrix().morph(s).at(o.ease(this.pos))):n.morph(s).at(o.ease(this.pos));continue}s.relative||s.undo(n.extract()),n=n.multiply(s.at(o.ease(this.pos)))}r.matrix(n)}return this},once:function(e,t,n){var i=this.last();return n||(e=i.ease(e)),i.once[e]=t,this},_callStart:function(){return setTimeout(function(){this.start()}.bind(this),0),this}},parent:k.Element,construct:{animate:function(e,t,n){return(this.fx||(this.fx=new k.FX(this))).animate(e,t,n)},delay:function(e){return(this.fx||(this.fx=new k.FX(this))).delay(e)},stop:function(e,t){return this.fx&&this.fx.stop(e,t),this},finish:function(){return this.fx&&this.fx.finish(),this},pause:function(){return this.fx&&this.fx.pause(),this},play:function(){return this.fx&&this.fx.play(),this},speed:function(e){if(this.fx){if(null==e)return this.fx.speed();this.fx.speed(e)}return this}}}),k.MorphObj=k.invent({create:function(e,t){return k.Color.isColor(t)?new k.Color(e).morph(t):k.regex.delimiter.test(e)?new k.Array(e).morph(t):k.regex.numberAndUnit.test(t)?new k.Number(e).morph(t):void(this.value=e,this.destination=t)},extend:{at:function(e,t){return 1>t?this.value:this.destination},valueOf:function(){return this.value}}}),k.extend(k.FX,{attr:function(e,t){if('object'==typeof e)for(var n in e)this.attr(n,e[n]);else this.add(e,t,'attrs');return this},style:function(e,t){if('object'==typeof e)for(var n in e)this.style(n,e[n]);else this.add(e,t,'styles');return this},x:function(e,t){if(this.target()instanceof k.G)return this.transform({x:e},t),this;var n=new k.Number(e);return n.relative=t,this.add('x',n)},y:function(e,t){if(this.target()instanceof k.G)return this.transform({y:e},t),this;var n=new k.Number(e);return n.relative=t,this.add('y',n)},cx:function(e){return this.add('cx',new k.Number(e))},cy:function(e){return this.add('cy',new k.Number(e))},move:function(e,t){return this.x(e).y(t)},center:function(e,t){return this.cx(e).cy(t)},size:function(e,t){if(this.target()instanceof k.Text)this.attr('font-size',e);else{var n;e&&t||(n=this.target().bbox()),e||(e=n.width/n.height*t),t||(t=n.height/n.width*e),this.add('width',new k.Number(e)).add('height',new k.Number(t))}return this},width:function(e){return this.add('width',new k.Number(e))},height:function(e){return this.add('height',new k.Number(e))},plot:function(e,t,n,i){return 4==arguments.length?this.plot([e,t,n,i]):this.add('plot',new(this.target().morphArray)(e))},leading:function(e){return this.target().leading?this.add('leading',new k.Number(e)):this},viewbox:function(e,t,n,i){return this.target()instanceof k.Container&&this.add('viewbox',new k.ViewBox(e,t,n,i)),this},update:function(e){if(this.target()instanceof k.Stop){if('number'==typeof e||e instanceof k.Number)return this.update({offset:arguments[0],color:arguments[1],opacity:arguments[2]});null!=e.opacity&&this.attr('stop-opacity',e.opacity),null!=e.color&&this.attr('stop-color',e.color),null!=e.offset&&this.attr('offset',e.offset)}return this}}),k.Box=k.invent({create:function(e,t,n,i){return'object'!=typeof e||e instanceof k.Element?void(4==arguments.length&&(this.x=e,this.y=t,this.width=n,this.height=i),v(this)):k.Box.call(this,null==e.left?e.x:e.left,null==e.top?e.y:e.top,e.width,e.height)},extend:{merge:function(e){var t=new this.constructor;return t.x=w(this.x,e.x),t.y=w(this.y,e.y),t.width=C(this.x+this.width,e.x+e.width)-t.x,t.height=C(this.y+this.height,e.y+e.height)-t.y,v(t)},transform:function(e){var t,n=Infinity,i=-Infinity,a=Infinity,r=-Infinity,o=[new k.Point(this.x,this.y),new k.Point(this.x2,this.y),new k.Point(this.x,this.y2),new k.Point(this.x2,this.y2)];return o.forEach(function(t){t=t.transform(e),n=w(n,t.x),i=C(i,t.x),a=w(a,t.y),r=C(r,t.y)}),t=new this.constructor,t.x=n,t.width=i-n,t.y=a,t.height=r-a,v(t),t}}}),k.BBox=k.invent({create:function(e){if(k.Box.apply(this,[].slice.call(arguments)),e instanceof k.Element){var n;try{if(!t.documentElement.contains){for(var i=e.node;i.parentNode;)i=i.parentNode;if(i!=t)throw new Exception('Element not in the dom')}else if(!t.documentElement.contains(e.node))throw new Exception('Element not in the dom');n=e.node.getBBox()}catch(t){if(e instanceof k.Shape){var a=e.clone(k.parser.draw.instance).show();n=a.node.getBBox(),a.remove()}else n={x:e.node.clientLeft,y:e.node.clientTop,width:e.node.clientWidth,height:e.node.clientHeight}}k.Box.call(this,n)}},inherit:k.Box,parent:k.Element,construct:{bbox:function(){return new k.BBox(this)}}}),k.BBox.prototype.constructor=k.BBox,k.extend(k.Element,{tbox:function(){return console.warn('Use of TBox is deprecated and mapped to RBox. Use .rbox() instead.'),this.rbox(this.doc())}}),k.RBox=k.invent({create:function(e){k.Box.apply(this,[].slice.call(arguments)),e instanceof k.Element&&k.Box.call(this,e.node.getBoundingClientRect())},inherit:k.Box,parent:k.Element,extend:{addOffset:function(){return this.x+=e.pageXOffset,this.y+=e.pageYOffset,this}},construct:{rbox:function(e){return e?new k.RBox(this).transform(e.screenCTM().inverse()):new k.RBox(this).addOffset()}}}),k.RBox.prototype.constructor=k.RBox,k.Matrix=k.invent({create:function(e){var t,n=h([1,0,0,1,0,0]);for(e=e instanceof k.Element?e.matrixify():'string'==typeof e?h(e.split(k.regex.delimiter).map(parseFloat)):6==arguments.length?h([].slice.call(arguments)):Array.isArray(e)?h(e):'object'==typeof e?e:n,t=_.length-1;0<=t;--t)this[_[t]]=null==e[_[t]]?n[_[t]]:e[_[t]]},extend:{extract:function(){var e=Math.sqrt,t=Math.atan2,n=p(this,0,1),i=p(this,1,0),a=180/P*t(n.y,n.x)-90;return{x:this.e,y:this.f,transformedX:(this.e*N(a*P/180)+this.f*b(a*P/180))/e(this.a*this.a+this.b*this.b),transformedY:(this.f*N(a*P/180)+this.e*b(-a*P/180))/e(this.c*this.c+this.d*this.d),skewX:-a,skewY:180/P*t(i.y,i.x),scaleX:e(this.a*this.a+this.b*this.b),scaleY:e(this.c*this.c+this.d*this.d),rotation:a,a:this.a,b:this.b,c:this.c,d:this.d,e:this.e,f:this.f,matrix:new k.Matrix(this)}},clone:function(){return new k.Matrix(this)},morph:function(e){return this.destination=new k.Matrix(e),this},at:function(e){if(!this.destination)return this;var t=new k.Matrix({a:this.a+(this.destination.a-this.a)*e,b:this.b+(this.destination.b-this.b)*e,c:this.c+(this.destination.c-this.c)*e,d:this.d+(this.destination.d-this.d)*e,e:this.e+(this.destination.e-this.e)*e,f:this.f+(this.destination.f-this.f)*e});return t},multiply:function(e){return new k.Matrix(this.native().multiply(m(e).native()))},inverse:function(){return new k.Matrix(this.native().inverse())},translate:function(e,t){return new k.Matrix(this.native().translate(e||0,t||0))},scale:function(e,t,n,i){return 1==arguments.length?t=e:3==arguments.length&&(i=n,n=t,t=e),this.around(n,i,new k.Matrix(e,0,0,t,0,0))},rotate:function(e,t,n){return e=k.utils.radians(e),this.around(t,n,new k.Matrix(N(e),b(e),-b(e),N(e),0,0))},flip:function(e,t){return'x'==e?this.scale(-1,1,t,0):'y'==e?this.scale(1,-1,0,t):this.scale(-1,-1,e,null==t?e:t)},skew:function(e,t,n,i){var a=Math.tan;return 1==arguments.length?t=e:3==arguments.length&&(i=n,n=t,t=e),e=k.utils.radians(e),t=k.utils.radians(t),this.around(n,i,new k.Matrix(1,a(t),a(e),1,0,0))},skewX:function(e,t,n){return this.skew(e,0,t,n)},skewY:function(e,t,n){return this.skew(0,e,t,n)},around:function(e,t,n){return this.multiply(new k.Matrix(1,0,0,1,e||0,t||0)).multiply(n).multiply(new k.Matrix(1,0,0,1,-e||0,-t||0))},native:function(){for(var e=k.parser.native.createSVGMatrix(),t=_.length-1;0<=t;t--)e[_[t]]=this[_[t]];return e},toString:function(){return'matrix('+this.a+','+this.b+','+this.c+','+this.d+','+this.e+','+this.f+')'}},parent:k.Element,construct:{ctm:function(){return new k.Matrix(this.node.getCTM())},screenCTM:function(){if(this instanceof k.Nested){var e=this.rect(1,1),t=e.node.getScreenCTM();return e.remove(),new k.Matrix(t)}return new k.Matrix(this.node.getScreenCTM())}}}),k.Point=k.invent({create:function(e,t){var n;n=Array.isArray(e)?{x:e[0],y:e[1]}:'object'==typeof e?{x:e.x,y:e.y}:null==e?{x:0,y:0}:{x:e,y:null==t?e:t},this.x=n.x,this.y=n.y},extend:{clone:function(){return new k.Point(this)},morph:function(e,t){return this.destination=new k.Point(e,t),this},at:function(e){if(!this.destination)return this;var t=new k.Point({x:this.x+(this.destination.x-this.x)*e,y:this.y+(this.destination.y-this.y)*e});return t},native:function(){var e=k.parser.native.createSVGPoint();return e.x=this.x,e.y=this.y,e},transform:function(e){return new k.Point(this.native().matrixTransform(e.native()))}}}),k.extend(k.Element,{point:function(e,t){return new k.Point(e,t).transform(this.screenCTM().inverse())}}),k.extend(k.Element,{attr:function(e,t,i){if(null==e){for(e={},t=this.node.attributes,i=t.length-1;0<=i;i--)e[t[i].nodeName]=k.regex.isNumber.test(t[i].nodeValue)?parseFloat(t[i].nodeValue):t[i].nodeValue;return e}if('object'==typeof e)for(t in e)this.attr(t,e[t]);else if(null===t)this.node.removeAttribute(e);else{if(null==t)return t=this.node.getAttribute(e),null==t?k.defaults.attrs[e]:k.regex.isNumber.test(t)?parseFloat(t):t;'stroke-width'==e?this.attr('stroke',0<parseFloat(t)?this._stroke:null):'stroke'==e&&(this._stroke=t),('fill'==e||'stroke'==e)&&(k.regex.isImage.test(t)&&(t=this.doc().defs().image(t,0,0)),t instanceof k.Image&&(t=this.doc().defs().pattern(0,0,function(){this.add(t)}))),'number'==typeof t?t=new k.Number(t):k.Color.isColor(t)?t=new k.Color(t):Array.isArray(t)&&(t=new k.Array(t)),'leading'==e?this.leading&&this.leading(t):'string'==typeof i?this.node.setAttributeNS(i,e,t.toString()):this.node.setAttribute(e,t.toString()),this.rebuild&&('font-size'==e||'x'==e)&&this.rebuild(e,t)}return this}}),k.extend(k.Element,{transform:function(t,n){var i,a,r=this;if('object'!=typeof t)return i=new k.Matrix(r).extract(),'string'==typeof t?i[t]:i;if(i=new k.Matrix(r),n=!!n||!!t.relative,null!=t.a)i=n?i.multiply(new k.Matrix(t)):new k.Matrix(t);else if(null!=t.rotation)x(t,r),i=n?i.rotate(t.rotation,t.cx,t.cy):i.rotate(t.rotation-i.extract().rotation,t.cx,t.cy);else if(null!=t.scale||null!=t.scaleX||null!=t.scaleY){if(x(t,r),t.scaleX=null==t.scale?null==t.scaleX?1:t.scaleX:t.scale,t.scaleY=null==t.scale?null==t.scaleY?1:t.scaleY:t.scale,!n){var s=i.extract();t.scaleX=1*t.scaleX/s.scaleX,t.scaleY=1*t.scaleY/s.scaleY}i=i.scale(t.scaleX,t.scaleY,t.cx,t.cy)}else if(null!=t.skew||null!=t.skewX||null!=t.skewY){if(x(t,r),t.skewX=null==t.skew?null==t.skewX?0:t.skewX:t.skew,t.skewY=null==t.skew?null==t.skewY?0:t.skewY:t.skew,!n){var s=i.extract();i=i.multiply(new k.Matrix().skew(s.skewX,s.skewY,t.cx,t.cy).inverse())}i=i.skew(t.skewX,t.skewY,t.cx,t.cy)}else t.flip?('x'==t.flip||'y'==t.flip?t.offset=null==t.offset?r.bbox()['c'+t.flip]:t.offset:null==t.offset?(a=r.bbox(),t.flip=a.cx,t.offset=a.cy):t.flip=t.offset,i=new k.Matrix().flip(t.flip,t.offset)):(null!=t.x||null!=t.y)&&(n?i=i.translate(t.x,t.y):(null!=t.x&&(i.e=t.x),null!=t.y&&(i.f=t.y)));return this.attr('transform',i)}}),k.extend(k.FX,{transform:function(e,t){var n,i,a=this.target();return'object'==typeof e?(t=!!t||!!e.relative,null==e.a?null==e.rotation?null!=e.scale||null!=e.scaleX||null!=e.scaleY?(x(e,a),e.scaleX=null==e.scale?null==e.scaleX?1:e.scaleX:e.scale,e.scaleY=null==e.scale?null==e.scaleY?1:e.scaleY:e.scale,n=new k.Scale(e.scaleX,e.scaleY,e.cx,e.cy)):null!=e.skewX||null!=e.skewY?(x(e,a),e.skewX=null==e.skewX?0:e.skewX,e.skewY=null==e.skewY?0:e.skewY,n=new k.Skew(e.skewX,e.skewY,e.cx,e.cy)):e.flip?('x'==e.flip||'y'==e.flip?e.offset=null==e.offset?a.bbox()['c'+e.flip]:e.offset:null==e.offset?(i=a.bbox(),e.flip=i.cx,e.offset=i.cy):e.flip=e.offset,n=new k.Matrix().flip(e.flip,e.offset)):(null!=e.x||null!=e.y)&&(n=new k.Translate(e.x,e.y)):(x(e,a),n=new k.Rotate(e.rotation,e.cx,e.cy)):n=new k.Matrix(e),!n)?this:(n.relative=t,this.last().transforms.push(n),this._callStart()):(n=new k.Matrix(a).extract(),'string'==typeof e?n[e]:n)}}),k.extend(k.Element,{untransform:function(){return this.attr('transform',null)},matrixify:function(){var e=(this.attr('transform')||'').split(k.regex.transforms).slice(0,-1).map(function(e){var t=e.trim().split('(');return[t[0],t[1].split(k.regex.delimiter).map(function(e){return parseFloat(e)})]}).reduce(function(e,t){return'matrix'==t[0]?e.multiply(h(t[1])):e[t[0]].apply(e,t[1])},new k.Matrix);return e},toParent:function(e){if(this==e)return this;var t=this.screenCTM(),n=e.screenCTM().inverse();return this.addTo(e).untransform().transform(n.multiply(t)),this},toDoc:function(){return this.toParent(this.doc())}}),k.Transformation=k.invent({create:function(e,t){if(1<arguments.length&&'boolean'!=typeof t)return this.constructor.call(this,[].slice.call(arguments));if(Array.isArray(e))for(var n=0,i=this.arguments.length;n<i;++n)this[this.arguments[n]]=e[n];else if('object'==typeof e)for(var n=0,i=this.arguments.length;n<i;++n)this[this.arguments[n]]=e[this.arguments[n]];this.inversed=!1,!0===t&&(this.inversed=!0)},extend:{arguments:[],method:'',at:function(e){for(var t=[],n=0,i=this.arguments.length;n<i;++n)t.push(this[this.arguments[n]]);var a=this._undo||new k.Matrix;return a=new k.Matrix().morph(k.Matrix.prototype[this.method].apply(a,t)).at(e),this.inversed?a.inverse():a},undo:function(e){for(var t=0,n=this.arguments.length;t<n;++t)e[this.arguments[t]]='undefined'==typeof this[this.arguments[t]]?0:e[this.arguments[t]];return e.cx=this.cx,e.cy=this.cy,this._undo=new k[s(this.method)](e,!0).at(1),this}}}),k.Translate=k.invent({parent:k.Matrix,inherit:k.Transformation,create:function(){this.constructor.apply(this,[].slice.call(arguments))},extend:{arguments:['transformedX','transformedY'],method:'translate'}}),k.Rotate=k.invent({parent:k.Matrix,inherit:k.Transformation,create:function(){this.constructor.apply(this,[].slice.call(arguments))},extend:{arguments:['rotation','cx','cy'],method:'rotate',at:function(e){var t=new k.Matrix().rotate(new k.Number().morph(this.rotation-(this._undo?this._undo.rotation:0)).at(e),this.cx,this.cy);return this.inversed?t.inverse():t},undo:function(e){return this._undo=e,this}}}),k.Scale=k.invent({parent:k.Matrix,inherit:k.Transformation,create:function(){this.constructor.apply(this,[].slice.call(arguments))},extend:{arguments:['scaleX','scaleY','cx','cy'],method:'scale'}}),k.Skew=k.invent({parent:k.Matrix,inherit:k.Transformation,create:function(){this.constructor.apply(this,[].slice.call(arguments))},extend:{arguments:['skewX','skewY','cx','cy'],method:'skew'}}),k.extend(k.Element,{style:function(e,t){if(0==arguments.length)return this.node.style.cssText||'';if(!(2>arguments.length))this.node.style[d(e)]=null===t||k.regex.isBlank.test(t)?'':t;else if('object'==typeof e)for(t in e)this.style(t,e[t]);else if(k.regex.isCss.test(e))for(e=e.split(/\s*;\s*/).filter(function(t){return!!t}).map(function(t){return t.split(/\s*:\s*/)});t=e.pop();)this.style(t[0],t[1]);else return this.node.style[d(e)];return this}}),k.Parent=k.invent({create:function(e){this.constructor.call(this,e)},inherit:k.Element,extend:{children:function(){return k.utils.map(k.utils.filterSVGElements(this.node.childNodes),function(e){return k.adopt(e)})},add:function(e,t){return null==t?this.node.appendChild(e.node):e.node!=this.node.childNodes[t]&&this.node.insertBefore(e.node,this.node.childNodes[t]),this},put:function(e,t){return this.add(e,t),e},has:function(e){return 0<=this.index(e)},index:function(e){return[].slice.call(this.node.childNodes).indexOf(e.node)},get:function(e){return k.adopt(this.node.childNodes[e])},first:function(){return this.get(0)},last:function(){return this.get(this.node.childNodes.length-1)},each:function(e,t){var n,i,a=this.children();for(n=0,i=a.length;n<i;n++)a[n]instanceof k.Element&&e.apply(a[n],[n,a]),t&&a[n]instanceof k.Container&&a[n].each(e,t);return this},removeElement:function(e){return this.node.removeChild(e.node),this},clear:function(){for(;this.node.hasChildNodes();)this.node.removeChild(this.node.lastChild);return delete this._defs,this},defs:function(){return this.doc().defs()}}}),k.extend(k.Parent,{ungroup:function(e,t){return 0===t||this instanceof k.Defs||this.node==k.parser.draw?this:(e=e||(this instanceof k.Doc?this:this.parent(k.Parent)),t=t||Infinity,this.each(function(){return this instanceof k.Defs?this:this instanceof k.Parent?this.ungroup(e,t-1):this.toParent(e)}),this.node.firstChild||this.remove(),this)},flatten:function(e,t){return this.ungroup(e,t)}}),k.Container=k.invent({create:function(e){this.constructor.call(this,e)},inherit:k.Parent}),k.ViewBox=k.invent({create:function(e){var t,n,i,a,r,o,s,d,l=1,u=1,c=/[+-]?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?/gi;if(e instanceof k.Element){for(s=e,d=e,o=(e.attr('viewBox')||'').match(c),r=e.bbox,i=new k.Number(e.width()),a=new k.Number(e.height());'%'==i.unit;)l*=i.value,i=new k.Number(s instanceof k.Doc?s.parent().offsetWidth:s.parent().width()),s=s.parent();for(;'%'==a.unit;)u*=a.value,a=new k.Number(d instanceof k.Doc?d.parent().offsetHeight:d.parent().height()),d=d.parent();this.x=0,this.y=0,this.width=i*l,this.height=a*u,this.zoom=1,o&&(t=parseFloat(o[0]),n=parseFloat(o[1]),i=parseFloat(o[2]),a=parseFloat(o[3]),this.zoom=this.width/this.height>i/a?this.height/a:this.width/i,this.x=t,this.y=n,this.width=i,this.height=a)}else e='string'==typeof e?e.match(c).map(function(e){return parseFloat(e)}):Array.isArray(e)?e:'object'==typeof e?[e.x,e.y,e.width,e.height]:4==arguments.length?[].slice.call(arguments):[0,0,0,0],this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]},extend:{toString:function(){return this.x+' '+this.y+' '+this.width+' '+this.height},morph:function(e,t,n,i){return this.destination=new k.ViewBox(e,t,n,i),this},at:function(e){return this.destination?new k.ViewBox([this.x+(this.destination.x-this.x)*e,this.y+(this.destination.y-this.y)*e,this.width+(this.destination.width-this.width)*e,this.height+(this.destination.height-this.height)*e]):this}},parent:k.Container,construct:{viewbox:function(e,t,n,i){return 0==arguments.length?new k.ViewBox(this):this.attr('viewBox',new k.ViewBox(e,t,n,i))}}}),['click','dblclick','mousedown','mouseup','mouseover','mouseout','mousemove','touchstart','touchmove','touchleave','touchend','touchcancel'].forEach(function(e){k.Element.prototype[e]=function(t){return k.on(this.node,e,t),this}}),k.listeners=[],k.handlerMap=[],k.listenerId=0,k.on=function(e,t,n,i,a){var r=n.bind(i||e.instance||e),o=(k.handlerMap.indexOf(e)+1||k.handlerMap.push(e))-1,s=t.split('.')[0],d=t.split('.')[1]||'*';k.listeners[o]=k.listeners[o]||{},k.listeners[o][s]=k.listeners[o][s]||{},k.listeners[o][s][d]=k.listeners[o][s][d]||{},n._svgjsListenerId||(n._svgjsListenerId=++k.listenerId),k.listeners[o][s][d][n._svgjsListenerId]=r,e.addEventListener(s,r,a||!1)},k.off=function(e,t,n){var i=k.handlerMap.indexOf(e),a=t&&t.split('.')[0],r=t&&t.split('.')[1],o='';if(-1!=i)if(n){if('function'==typeof n&&(n=n._svgjsListenerId),!n)return;k.listeners[i][a]&&k.listeners[i][a][r||'*']&&(e.removeEventListener(a,k.listeners[i][a][r||'*'][n],!1),delete k.listeners[i][a][r||'*'][n])}else if(r&&a){if(k.listeners[i][a]&&k.listeners[i][a][r]){for(n in k.listeners[i][a][r])k.off(e,[a,r].join('.'),n);delete k.listeners[i][a][r]}}else if(r)for(t in k.listeners[i])for(o in k.listeners[i][t])r===o&&k.off(e,[t,r].join('.'));else if(!a){for(t in k.listeners[i])k.off(e,t);delete k.listeners[i],delete k.handlerMap[i]}else if(k.listeners[i][a]){for(o in k.listeners[i][a])k.off(e,[a,o].join('.'));delete k.listeners[i][a]}},k.extend(k.Element,{on:function(e,t,n,i){return k.on(this.node,e,t,n,i),this},off:function(e,t){return k.off(this.node,e,t),this},fire:function(t,n){return t instanceof e.Event?this.node.dispatchEvent(t):this.node.dispatchEvent(t=new e.CustomEvent(t,{detail:n,cancelable:!0})),this._event=t,this},event:function(){return this._event}}),k.Defs=k.invent({create:'defs',inherit:k.Container}),k.G=k.invent({create:'g',inherit:k.Container,extend:{x:function(e){return null==e?this.transform('x'):this.transform({x:e-this.x()},!0)},y:function(e){return null==e?this.transform('y'):this.transform({y:e-this.y()},!0)},cx:function(e){return null==e?this.gbox().cx:this.x(e-this.gbox().width/2)},cy:function(e){return null==e?this.gbox().cy:this.y(e-this.gbox().height/2)},gbox:function(){var e=this.bbox(),t=this.transform();return e.x+=t.x,e.x2+=t.x,e.cx+=t.x,e.y+=t.y,e.y2+=t.y,e.cy+=t.y,e}},construct:{group:function(){return this.put(new k.G)}}}),k.extend(k.Element,{siblings:function(){return this.parent().children()},position:function(){return this.parent().index(this)},next:function(){return this.siblings()[this.position()+1]},previous:function(){return this.siblings()[this.position()-1]},forward:function(){var e=this.position()+1,t=this.parent();return t.removeElement(this).add(this,e),t instanceof k.Doc&&t.node.appendChild(t.defs().node),this},backward:function(){var e=this.position();return 0<e&&this.parent().removeElement(this).add(this,e-1),this},front:function(){var e=this.parent();return e.node.appendChild(this.node),e instanceof k.Doc&&e.node.appendChild(e.defs().node),this},back:function(){return 0<this.position()&&this.parent().removeElement(this).add(this,0),this},before:function(e){e.remove();var t=this.position();return this.parent().add(e,t),this},after:function(e){e.remove();var t=this.position();return this.parent().add(e,t+1),this}}),k.Mask=k.invent({create:function(){this.constructor.call(this,k.create('mask')),this.targets=[]},inherit:k.Container,extend:{remove:function(){for(var e=this.targets.length-1;0<=e;e--)this.targets[e]&&this.targets[e].unmask();return this.targets=[],this.parent().removeElement(this),this}},construct:{mask:function(){return this.defs().put(new k.Mask)}}}),k.extend(k.Element,{maskWith:function(e){return this.masker=e instanceof k.Mask?e:this.parent().mask().add(e),this.masker.targets.push(this),this.attr('mask','url("#'+this.masker.attr('id')+'")')},unmask:function(){return delete this.masker,this.attr('mask',null)}}),k.ClipPath=k.invent({create:function(){this.constructor.call(this,k.create('clipPath')),this.targets=[]},inherit:k.Container,extend:{remove:function(){for(var e=this.targets.length-1;0<=e;e--)this.targets[e]&&this.targets[e].unclip();return this.targets=[],this.parent().removeElement(this),this}},construct:{clip:function(){return this.defs().put(new k.ClipPath)}}}),k.extend(k.Element,{clipWith:function(e){return this.clipper=e instanceof k.ClipPath?e:this.parent().clip().add(e),this.clipper.targets.push(this),this.attr('clip-path','url("#'+this.clipper.attr('id')+'")')},unclip:function(){return delete this.clipper,this.attr('clip-path',null)}}),k.Gradient=k.invent({create:function(e){this.constructor.call(this,k.create(e+'Gradient')),this.type=e},inherit:k.Container,extend:{at:function(e,t,n){return this.put(new k.Stop).update(e,t,n)},update:function(e){return this.clear(),'function'==typeof e&&e.call(this,this),this},fill:function(){return'url(#'+this.id()+')'},toString:function(){return this.fill()},attr:function(e,t,n){return'transform'==e&&(e='gradientTransform'),k.Container.prototype.attr.call(this,e,t,n)}},construct:{gradient:function(e,t){return this.defs().gradient(e,t)}}}),k.extend(k.Gradient,k.FX,{from:function(e,t){return'radial'==(this._target||this).type?this.attr({fx:new k.Number(e),fy:new k.Number(t)}):this.attr({x1:new k.Number(e),y1:new k.Number(t)})},to:function(e,t){return'radial'==(this._target||this).type?this.attr({cx:new k.Number(e),cy:new k.Number(t)}):this.attr({x2:new k.Number(e),y2:new k.Number(t)})}}),k.extend(k.Defs,{gradient:function(e,t){return this.put(new k.Gradient(e)).update(t)}}),k.Stop=k.invent({create:'stop',inherit:k.Element,extend:{update:function(e){return('number'==typeof e||e instanceof k.Number)&&(e={offset:arguments[0],color:arguments[1],opacity:arguments[2]}),null!=e.opacity&&this.attr('stop-opacity',e.opacity),null!=e.color&&this.attr('stop-color',e.color),null!=e.offset&&this.attr('offset',new k.Number(e.offset)),this}}}),k.Pattern=k.invent({create:'pattern',inherit:k.Container,extend:{fill:function(){return'url(#'+this.id()+')'},update:function(e){return this.clear(),'function'==typeof e&&e.call(this,this),this},toString:function(){return this.fill()},attr:function(e,t,n){return'transform'==e&&(e='patternTransform'),k.Container.prototype.attr.call(this,e,t,n)}},construct:{pattern:function(e,t,n){return this.defs().pattern(e,t,n)}}}),k.extend(k.Defs,{pattern:function(e,t,n){return this.put(new k.Pattern).update(n).attr({x:0,y:0,width:e,height:t,patternUnits:'userSpaceOnUse'})}}),k.Doc=k.invent({create:function(e){e&&(e='string'==typeof e?t.getElementById(e):e,'svg'==e.nodeName?this.constructor.call(this,e):(this.constructor.call(this,k.create('svg')),e.appendChild(this.node),this.size('100%','100%')),this.namespace().defs())},inherit:k.Container,extend:{namespace:function(){return this.attr({xmlns:k.ns,version:'1.1'}).attr('xmlns:xlink',k.xlink,k.xmlns).attr('xmlns:svgjs',k.svgjs,k.xmlns)},defs:function(){if(!this._defs){var e;this._defs=(e=this.node.getElementsByTagName('defs')[0])?k.adopt(e):new k.Defs,this.node.appendChild(this._defs.node)}return this._defs},parent:function(){return'#document'==this.node.parentNode.nodeName?null:this.node.parentNode},spof:function(){var e=this.node.getScreenCTM();return e&&this.style('left',-e.e%1+'px').style('top',-e.f%1+'px'),this},remove:function(){return this.parent()&&this.parent().removeChild(this.node),this},clear:function(){for(;this.node.hasChildNodes();)this.node.removeChild(this.node.lastChild);return delete this._defs,k.parser.draw.parentNode||this.node.appendChild(k.parser.draw),this}}}),k.Shape=k.invent({create:function(e){this.constructor.call(this,e)},inherit:k.Element}),k.Bare=k.invent({create:function(e,t){if(this.constructor.call(this,k.create(e)),t)for(var n in t.prototype)'function'==typeof t.prototype[n]&&(this[n]=t.prototype[n])},inherit:k.Element,extend:{words:function(e){for(;this.node.hasChildNodes();)this.node.removeChild(this.node.lastChild);return this.node.appendChild(t.createTextNode(e)),this}}}),k.extend(k.Parent,{element:function(e,t){return this.put(new k.Bare(e,t))}}),k.Symbol=k.invent({create:'symbol',inherit:k.Container,construct:{symbol:function(){return this.put(new k.Symbol)}}}),k.Use=k.invent({create:'use',inherit:k.Shape,extend:{element:function(e,t){return this.attr('href',(t||'')+'#'+e,k.xlink)}},construct:{use:function(e,t){return this.put(new k.Use).element(e,t)}}}),k.Rect=k.invent({create:'rect',inherit:k.Shape,construct:{rect:function(e,t){return this.put(new k.Rect).size(e,t)}}}),k.Circle=k.invent({create:'circle',inherit:k.Shape,construct:{circle:function(e){return this.put(new k.Circle).rx(new k.Number(e).divide(2)).move(0,0)}}}),k.extend(k.Circle,k.FX,{rx:function(e){return this.attr('r',e)},ry:function(e){return this.rx(e)}}),k.Ellipse=k.invent({create:'ellipse',inherit:k.Shape,construct:{ellipse:function(e,t){return this.put(new k.Ellipse).size(e,t).move(0,0)}}}),k.extend(k.Ellipse,k.Rect,k.FX,{rx:function(e){return this.attr('rx',e)},ry:function(e){return this.attr('ry',e)}}),k.extend(k.Circle,k.Ellipse,{x:function(e){return null==e?this.cx()-this.rx():this.cx(e+this.rx())},y:function(e){return null==e?this.cy()-this.ry():this.cy(e+this.ry())},cx:function(e){return null==e?this.attr('cx'):this.attr('cx',e)},cy:function(e){return null==e?this.attr('cy'):this.attr('cy',e)},width:function(e){return null==e?2*this.rx():this.rx(new k.Number(e).divide(2))},height:function(e){return null==e?2*this.ry():this.ry(new k.Number(e).divide(2))},size:function(e,t){var n=c(this,e,t);return this.rx(new k.Number(n.width).divide(2)).ry(new k.Number(n.height).divide(2))}}),k.Line=k.invent({create:'line',inherit:k.Shape,extend:{array:function(){return new k.PointArray([[this.attr('x1'),this.attr('y1')],[this.attr('x2'),this.attr('y2')]])},plot:function(e,t,n,i){return null==e?this.array():(e='undefined'==typeof t?new k.PointArray(e).toLine():{x1:e,y1:t,x2:n,y2:i},this.attr(e))},move:function(e,t){return this.attr(this.array().move(e,t).toLine())},size:function(e,t){var n=c(this,e,t);return this.attr(this.array().size(n.width,n.height).toLine())}},construct:{line:function(e,t,n,i){return k.Line.prototype.plot.apply(this.put(new k.Line),null==e?[0,0,0,0]:[e,t,n,i])}}}),k.Polyline=k.invent({create:'polyline',inherit:k.Shape,construct:{polyline:function(e){return this.put(new k.Polyline).plot(e||new k.PointArray)}}}),k.Polygon=k.invent({create:'polygon',inherit:k.Shape,construct:{polygon:function(e){return this.put(new k.Polygon).plot(e||new k.PointArray)}}}),k.extend(k.Polyline,k.Polygon,{array:function(){return this._array||(this._array=new k.PointArray(this.attr('points')))},plot:function(e){return null==e?this.array():this.clear().attr('points','string'==typeof e?e:this._array=new k.PointArray(e))},clear:function(){return delete this._array,this},move:function(e,t){return this.attr('points',this.array().move(e,t))},size:function(e,t){var n=c(this,e,t);return this.attr('points',this.array().size(n.width,n.height))}}),k.extend(k.Line,k.Polyline,k.Polygon,{morphArray:k.PointArray,x:function(e){return null==e?this.bbox().x:this.move(e,this.bbox().y)},y:function(e){return null==e?this.bbox().y:this.move(this.bbox().x,e)},width:function(e){var t=this.bbox();return null==e?t.width:this.size(e,t.height)},height:function(e){var t=this.bbox();return null==e?t.height:this.size(t.width,e)}}),k.Path=k.invent({create:'path',inherit:k.Shape,extend:{morphArray:k.PathArray,array:function(){return this._array||(this._array=new k.PathArray(this.attr('d')))},plot:function(e){return null==e?this.array():this.clear().attr('d','string'==typeof e?e:this._array=new k.PathArray(e))},clear:function(){return delete this._array,this},move:function(e,t){return this.attr('d',this.array().move(e,t))},x:function(e){return null==e?this.bbox().x:this.move(e,this.bbox().y)},y:function(e){return null==e?this.bbox().y:this.move(this.bbox().x,e)},size:function(e,t){var n=c(this,e,t);return this.attr('d',this.array().size(n.width,n.height))},width:function(e){return null==e?this.bbox().width:this.size(e,this.bbox().height)},height:function(e){return null==e?this.bbox().height:this.size(this.bbox().width,e)}},construct:{path:function(e){return this.put(new k.Path).plot(e||new k.PathArray)}}}),k.Image=k.invent({create:'image',inherit:k.Shape,extend:{load:function(t){if(!t)return this;var n=this,i=new e.Image;return k.on(i,'load',function(){var e=n.parent(k.Pattern);null===e||(0==n.width()&&0==n.height()&&n.size(i.width,i.height),e&&0==e.width()&&0==e.height()&&e.size(n.width(),n.height()),'function'==typeof n._loaded&&n._loaded.call(n,{width:i.width,height:i.height,ratio:i.width/i.height,url:t}))}),k.on(i,'error',function(t){'function'==typeof n._error&&n._error.call(n,t)}),this.attr('href',i.src=this.src=t,k.xlink)},loaded:function(e){return this._loaded=e,this},error:function(e){return this._error=e,this}},construct:{image:function(e,t,n){return this.put(new k.Image).load(e).size(t||0,n||t||0)}}}),k.Text=k.invent({create:function(){this.constructor.call(this,k.create('text')),this.dom.leading=new k.Number(1.3),this._rebuild=!0,this._build=!1,this.attr('font-family',k.defaults.attrs['font-family'])},inherit:k.Shape,extend:{x:function(e){return null==e?this.attr('x'):this.attr('x',e)},y:function(e){var t=this.attr('y'),n='number'==typeof t?t-this.bbox().y:0;return null==e?'number'==typeof t?t-n:t:this.attr('y','number'==typeof e?e+n:e)},cx:function(e){return null==e?this.bbox().cx:this.x(e-this.bbox().width/2)},cy:function(e){return null==e?this.bbox().cy:this.y(e-this.bbox().height/2)},text:function(e){if('undefined'==typeof e){for(var e='',t=this.node.childNodes,n=0,i=t.length;n<i;++n)0!=n&&3!=t[n].nodeType&&!0==k.adopt(t[n]).dom.newLined&&(e+='\n'),e+=t[n].textContent;return e}if(this.clear().build(!0),'function'==typeof e)e.call(this,this);else{e=e.split('\n');for(var n=0,a=e.length;n<a;n++)this.tspan(e[n]).newLine()}return this.build(!1).rebuild()},size:function(e){return this.attr('font-size',e).rebuild()},leading:function(e){return null==e?this.dom.leading:(this.dom.leading=new k.Number(e),this.rebuild())},lines:function(){var e=(this.textPath&&this.textPath()||this).node,t=k.utils.map(k.utils.filterSVGElements(e.childNodes),function(e){return k.adopt(e)});return new k.Set(t)},rebuild:function(e){if('boolean'==typeof e&&(this._rebuild=e),this._rebuild){var t=this,n=0,i=this.dom.leading*new k.Number(this.attr('font-size'));this.lines().each(function(){this.dom.newLined&&(!t.textPath()&&this.attr('x',t.attr('x')),'\n'==this.text()?n+=i:(this.attr('dy',i+n),n=0))}),this.fire('rebuild')}return this},build:function(e){return this._build=!!e,this},setData:function(e){return this.dom=e,this.dom.leading=new k.Number(e.leading||1.3),this}},construct:{text:function(e){return this.put(new k.Text).text(e)},plain:function(e){return this.put(new k.Text).plain(e)}}}),k.Tspan=k.invent({create:'tspan',inherit:k.Shape,extend:{text:function(e){return null==e?this.node.textContent+(this.dom.newLined?'\n':''):('function'==typeof e?e.call(this,this):this.plain(e),this)},dx:function(e){return this.attr('dx',e)},dy:function(e){return this.attr('dy',e)},newLine:function(){var e=this.parent(k.Text);return this.dom.newLined=!0,this.dy(e.dom.leading*e.attr('font-size')).attr('x',e.x())}}}),k.extend(k.Text,k.Tspan,{plain:function(e){return!1===this._build&&this.clear(),this.node.appendChild(t.createTextNode(e)),this},tspan:function(e){var t=(this.textPath&&this.textPath()||this).node,n=new k.Tspan;return!1===this._build&&this.clear(),t.appendChild(n.node),n.text(e)},clear:function(){for(var e=(this.textPath&&this.textPath()||this).node;e.hasChildNodes();)e.removeChild(e.lastChild);return this},length:function(){return this.node.getComputedTextLength()}}),k.TextPath=k.invent({create:'textPath',inherit:k.Parent,parent:k.Text,construct:{morphArray:k.PathArray,path:function(e){for(var t=new k.TextPath,n=this.doc().defs().path(e);this.node.hasChildNodes();)t.node.appendChild(this.node.firstChild);return this.node.appendChild(t.node),t.attr('href','#'+n,k.xlink),this},array:function(){var e=this.track();return e?e.array():null},plot:function(e){var t=this.track(),n=null;return t&&(n=t.plot(e)),null==e?n:this},track:function(){var e=this.textPath();if(e)return e.reference('href')},textPath:function(){if(this.node.firstChild&&'textPath'==this.node.firstChild.nodeName)return k.adopt(this.node.firstChild)}}}),k.Nested=k.invent({create:function(){this.constructor.call(this,k.create('svg')),this.style('overflow','visible')},inherit:k.Container,construct:{nested:function(){return this.put(new k.Nested)}}}),k.A=k.invent({create:'a',inherit:k.Container,extend:{to:function(e){return this.attr('href',e,k.xlink)},show:function(e){return this.attr('show',e,k.xlink)},target:function(e){return this.attr('target',e)}},construct:{link:function(e){return this.put(new k.A).to(e)}}}),k.extend(k.Element,{linkTo:function(e){var t=new k.A;return'function'==typeof e?e.call(t,t):t.to(e),this.parent().put(t).put(this)}}),k.Marker=k.invent({create:'marker',inherit:k.Container,extend:{width:function(e){return this.attr('markerWidth',e)},height:function(e){return this.attr('markerHeight',e)},ref:function(e,t){return this.attr('refX',e).attr('refY',t)},update:function(e){return this.clear(),'function'==typeof e&&e.call(this,this),this},toString:function(){return'url(#'+this.id()+')'}},construct:{marker:function(e,t,n){return this.defs().marker(e,t,n)}}}),k.extend(k.Defs,{marker:function(e,t,n){return this.put(new k.Marker).size(e,t).ref(e/2,t/2).viewbox(0,0,e,t).attr('orient','auto').update(n)}}),k.extend(k.Line,k.Polyline,k.Polygon,k.Path,{marker:function(e,t,n,i){var a=['marker'];return'all'!=e&&a.push(e),a=a.join('-'),e=arguments[1]instanceof k.Marker?arguments[1]:this.doc().marker(t,n,i),this.attr(a,e)}});var M={stroke:['color','width','opacity','linecap','linejoin','miterlimit','dasharray','dashoffset'],fill:['color','opacity','rule'],prefix:function(e,t){return'color'==t?e:e+'-'+t}};['fill','stroke'].forEach(function(e){var t,n={};n[e]=function(n){if('undefined'==typeof n)return this;if('string'==typeof n||k.Color.isRgb(n)||n&&'function'==typeof n.fill)this.attr(e,n);else for(t=M[e].length-1;0<=t;t--)null!=n[M[e][t]]&&this.attr(M.prefix(e,M[e][t]),n[M[e][t]]);return this},k.extend(k.Element,k.FX,n)}),k.extend(k.Element,k.FX,{rotate:function(e,t,n){return this.transform({rotation:e,cx:t,cy:n})},skew:function(e,t,n,i){return 1==arguments.length||3==arguments.length?this.transform({skew:e,cx:t,cy:n}):this.transform({skewX:e,skewY:t,cx:n,cy:i})},scale:function(e,t,n,i){return 1==arguments.length||3==arguments.length?this.transform({scale:e,cx:t,cy:n}):this.transform({scaleX:e,scaleY:t,cx:n,cy:i})},translate:function(e,t){return this.transform({x:e,y:t})},flip:function(e,t){return t='number'==typeof e?e:t,this.transform({flip:e||'both',offset:t})},matrix:function(e){return this.attr('transform',new k.Matrix(6==arguments.length?[].slice.call(arguments):e))},opacity:function(e){return this.attr('opacity',e)},dx:function(e){return this.x(new k.Number(e).plus(this instanceof k.FX?0:this.x()),!0)},dy:function(e){return this.y(new k.Number(e).plus(this instanceof k.FX?0:this.y()),!0)},dmove:function(e,t){return this.dx(e).dy(t)}}),k.extend(k.Rect,k.Ellipse,k.Circle,k.Gradient,k.FX,{radius:function(e,t){var n=(this._target||this).type;return'radial'==n||'circle'==n?this.attr('r',new k.Number(e)):this.rx(e).ry(null==t?e:t)}}),k.extend(k.Path,{length:function(){return this.node.getTotalLength()},pointAt:function(e){return this.node.getPointAtLength(e)}}),k.extend(k.Parent,k.Text,k.Tspan,k.FX,{font:function(e,t){if('object'==typeof e)for(t in e)this.font(t,e[t]);return'leading'==e?this.leading(t):'anchor'==e?this.attr('text-anchor',t):'size'==e||'family'==e||'weight'==e||'stretch'==e||'variant'==e||'style'==e?this.attr('font-'+e,t):this.attr(e,t)}}),k.Set=k.invent({create:function(e){Array.isArray(e)?this.members=e:this.clear()},extend:{add:function(){var e,t,n=[].slice.call(arguments);for(e=0,t=n.length;e<t;e++)this.members.push(n[e]);return this},remove:function(e){var t=this.index(e);return-1<t&&this.members.splice(t,1),this},each:function(e){for(var t=0,n=this.members.length;t<n;t++)e.apply(this.members[t],[t,this.members]);return this},clear:function(){return this.members=[],this},length:function(){return this.members.length},has:function(e){return 0<=this.index(e)},index:function(e){return this.members.indexOf(e)},get:function(e){return this.members[e]},first:function(){return this.get(0)},last:function(){return this.get(this.members.length-1)},valueOf:function(){return this.members},bbox:function(){if(0==this.members.length)return new k.RBox;var e=this.members[0].rbox(this.members[0].doc());return this.each(function(){e=e.merge(this.rbox(this.doc()))}),e}},construct:{set:function(e){return new k.Set(e)}}}),k.FX.Set=k.invent({create:function(e){this.set=e}}),k.Set.inherit=function(){var e,t=[];for(var e in k.Shape.prototype)'function'==typeof k.Shape.prototype[e]&&'function'!=typeof k.Set.prototype[e]&&t.push(e);for(var e in t.forEach(function(e){k.Set.prototype[e]=function(){for(var t=0,n=this.members.length;t<n;t++)this.members[t]&&'function'==typeof this.members[t][e]&&this.members[t][e].apply(this.members[t],arguments);return'animate'==e?this.fx||(this.fx=new k.FX.Set(this)):this}}),t=[],k.FX.prototype)'function'==typeof k.FX.prototype[e]&&'function'!=typeof k.FX.Set.prototype[e]&&t.push(e);t.forEach(function(e){k.FX.Set.prototype[e]=function(){for(var t=0,n=this.set.members.length;t<n;t++)this.set.members[t].fx[e].apply(this.set.members[t].fx,arguments);return this}})},k.extend(k.Element,{data:function(e,t,n){if('object'==typeof e)for(t in e)this.data(t,e[t]);else if(2>arguments.length)try{return JSON.parse(this.attr('data-'+e))}catch(t){return this.attr('data-'+e)}else this.attr('data-'+e,null===t?null:!0===n||'string'==typeof t||'number'==typeof t?t:JSON.stringify(t));return this}}),k.extend(k.Element,{remember:function(e,t){if('object'==typeof arguments[0])for(var t in e)this.remember(t,e[t]);else{if(1==arguments.length)return this.memory()[e];this.memory()[e]=t}return this},forget:function(){if(0==arguments.length)this._memory={};else for(var e=arguments.length-1;0<=e;e--)delete this.memory()[arguments[e]];return this},memory:function(){return this._memory||(this._memory={})}}),k.get=function(e){var n=t.getElementById(y(e)||e);return k.adopt(n)},k.select=function(e,n){return new k.Set(k.utils.map((n||t).querySelectorAll(e),function(e){return k.adopt(e)}))},k.extend(k.Parent,{select:function(e){return k.select(e,this.node)}});var _=['a','b','c','d','e','f'];if('function'!=typeof e.CustomEvent){var T=function(n,i){i=i||{bubbles:!1,cancelable:!1,detail:void 0};var a=t.createEvent('CustomEvent');return a.initCustomEvent(n,i.bubbles,i.cancelable,i.detail),a};T.prototype=e.Event.prototype,e.CustomEvent=T}return function(t){for(var n=0,i=['moz','webkit'],a=0;a<i.length&&!e.requestAnimationFrame;++a)t.requestAnimationFrame=t[i[a]+'RequestAnimationFrame'],t.cancelAnimationFrame=t[i[a]+'CancelAnimationFrame']||t[i[a]+'CancelRequestAnimationFrame'];t.requestAnimationFrame=t.requestAnimationFrame||function(e){var i=new Date().getTime(),a=C(0,16-(i-n)),r=t.setTimeout(function(){e(i+a)},a);return n=i+a,r},t.cancelAnimationFrame=t.cancelAnimationFrame||t.clearTimeout}(e),k})}])});
//# sourceMappingURL=reaction.min.js.map